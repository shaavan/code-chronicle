# Log 180: _We Chart Beyond_

> 25 June 2025

## What I Worked On:

- [Expanded](https://github.com/shaavan/rust-lightning/commits/currency-11)
  explorations into the trait-based approach for the Flow event model

## Reflections:

Today, I dove deeper into the ideas my mentor and I discussed yesterday for the
event model.

The core question is this:  
We’ve already introduced a **compile-time guarantee** for
`VerifiedInvoiceRequest` based on the signing keys it carries (derived vs
explicit).  
Can we now do the same for the **amount source** — enforcing at the type level
whether the amount was specified in the `Offer`, in the `InvoiceRequest`, or in
both?

The design challenge that followed was subtle but real:  
We currently split `VerifiedInvoiceRequestEnum` into two variants (based on
signing keys).  
But if we layer in amount-source tracking, we now introduce three possible
states:

- OfferAmountOnly
- IRAmountOnly
- BothIR&OfferAmount

Naively combining these would lead to a **multiplicative explosion** of variants
and duplicate function definitions — something I’m keen to avoid.

So the question became: _how do we model this expressively, without blowing up
the combinatorial surface of the API?_

That’s the puzzle I explored today. And while the path isn’t fully paved yet, I
can see light beginning to shine through the cracks.  
Tomorrow, I expect clarity to land — and I’ll be glad to write about it when it
does.

One step deeper into the architecture. One level closer to elegance.
