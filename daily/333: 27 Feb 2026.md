# Log 333: Making the Right Path Obvious

> 27 Feb 2026

## What I Worked On

- [Finished] currency conversion testing and refined the surrounding API design

## Reflections

Today was about completing the currency conversion tests â€” and, in the process,
letting the API shape itself more clearly.

While wiring up the tests, I noticed several opportunities to simplify both the
public surface and the internal flow. That led to introducing a new
`payable_amount_msats` API on `InvoiceRequest`, which now centralizes all
currency conversion and amount correctness checks before returning a value. With
this in place, both users and invoice builders can trivially obtain the _right_
amount in millisatoshis without duplicating logic or second-guessing conversion
semantics.

Having this general API also allowed me to simplify the existing
`InvoiceRequest::amount_msats()` method. It now does exactly what its name
suggests: returns the explicitly set amount on the invoice request, without
trying to infer values from the underlying offer when the amount is absent. That
distinction makes the API clearer and the behavior more predictable.

With these pieces in place, I was able to put the APIs to use and complete
currency conversion testing across the codebase.

The core work is now done. What remains is cleanup, polish, and pushing the
branch.

[Finished]: https://github.com/shaavan/rust-lightning/commits/currency-51
