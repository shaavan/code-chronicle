# Log 334: Tightening the Logic

> 28 Feb 2026

## What I Worked On

- [Refined] the currency conversion branch and prepared it for PR

## Reflections

After yesterdayâ€™s implementation work, there were still a few logical edges that
needed careful attention.

Today was about understanding how the newly introduced pieces fit together and
clarifying the responsibility of each API. In particular, I revisited questions
around where validation should live. Should
`InvoiceRequest::payable_amount_msats()` merely return a value, or should it
also enforce correctness? If validation is deferred, how do we ensure it is
reliably performed at invoice creation time?

I also tightened the logic around how an `InvoiceRequest` is constructed when
responding to an Offer with a currency-denominated amount, making sure the flow
is both explicit and hard to misuse.

With those questions resolved, I was able to clean up the branch, remove
unnecessary inter-code coupling, and arrive at a version that feels coherent and
ready to be presented.

What remains is a final round of CI testing before opening the PR.

[Refined]: https://github.com/shaavan/rust-lightning/commits/currency-55
