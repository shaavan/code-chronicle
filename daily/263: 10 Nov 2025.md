# Log 263: The Light at the End

> 10 Nov 2025

## What I Worked On

- [Found] the result of the [#3833] experimental approach.

## Reflections

Today, I carried the experimental approach forward — decoding currency at the
**parse** level itself — and reached a clear conclusion.  
It’s an elegant idea in theory, but not one that fits within LDK’s architecture.

Here’s why:  
All parsing for every type of onion message — Offers, Async, DNS, or custom —
happens at the **OnionMessenger** level, which then delegates each message to
its respective handler.  
To parse currency at this level, the OnionMessenger would have to be
parameterized by a currency conversion implementor.

That immediately creates two problems:

1. Currency conversion is relevant _only_ to Offer messages.
2. The role of OnionMessenger is strictly communication and delegation —
   introducing currency logic would blur its architectural boundaries.

And that’s the verdict.  
The idea was clean, but the fit wasn’t right.  
Even so, reaching this conclusion feels like progress — the fog has lifted, and
I know with certainty that the original approach remains the soundest one.

[Found]: https://github.com/shaavan/rust-lightning/commits/currency-33
[#3833]: https://github.com/lightningdevkit/rust-lightning/pull/3833
