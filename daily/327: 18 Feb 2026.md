# Log 327: Threading the Needle

> 18 Feb 2026

## What I Worked On

- [Implemented] a solution for building `InvoiceRequest`s with currency
  conversion

## Reflections

After yesterday’s discussion with my mentor, I focused on solving the first half
of the problem: how to handle currency conversion efficiently during
`InvoiceRequest` creation.

The approach we landed on turned out to be both simple and effective. The key
insight was that correctness of the amount only needs to be enforced at the
point of **building and signing** the `InvoiceRequest`. There’s no need to
thread currency conversion through those function signatures directly, which
would only add noise and complexity.

Instead, we take and store a reference to the `CurrencyConversion` at the time
the invoice is requested, and carry that reference forward into the
`InvoiceRequest` builder. When the final checks are performed, the conversion
context is already available — without polluting the rest of the API.

This small shift significantly reduced code complexity and naturally sets up the
solution for the parsing side of `InvoiceRequest`, which is the next piece to
tackle.

Looking forward to diving into that tomorrow.

[Implemented]: https://github.com/shaavan/rust-lightning/commits/currency-45
