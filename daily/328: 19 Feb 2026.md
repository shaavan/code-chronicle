# Log 328: The Tower of Types

> 19 Feb 2026

## What I Worked On

- [Experimented] with resolving a type-level issue in the currency
  implementation

## Reflections

After implementing yesterday’s solution, I ran into an interesting compile-time
issue.

While building an `InvoiceRequest` parameterized over the currency conversion
type, I found that I couldn’t directly pass the flow’s `currency_conversion`
through as expected. The root of the issue was subtle: `InvoiceRequest` expects
ownership of a `CurrencyConversion`, while the flow only holds a dereferenced
reference to it.

This led me down a short but instructive path — experimenting with alternative
designs, rewriting parts of `InvoiceRequest`, and adjusting the surrounding code
to see if the ownership model could be reshaped more cleanly.

In the end, the simplest solution turned out to be the right one. Cloning the
`currency_conversion` avoids unnecessary contortions in the type system and
keeps the overall design straightforward. If needed, this can be refined later,
but for now it strikes the right balance between correctness and complexity.

Most importantly, the branch is now working end-to-end.

[Experimented]: https://github.com/shaavan/rust-lightning/commits/currency-46
